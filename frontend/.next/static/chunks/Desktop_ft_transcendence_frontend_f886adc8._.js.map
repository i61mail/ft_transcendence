{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/shamdoun/Desktop/ft_transcendence/frontend/context/ChatContextProvider.tsx"],"sourcesContent":["\"use client\"\nimport { useContext, createContext, useState } from \"react\";\nimport { MessageProps, UserProps } from \"@/types/common.types\";\nimport type { FriendshipProps } from \"@/components/features/chat/AllChats\";\n\ninterface ChatContextProps \n{\n    filter: string,\n    pointedUser: FriendshipProps | null,\n    friends: FriendshipProps[],\n    messages: MessageProps[],\n    changeFilter: (filter: string) => void,\n    changePointedUser: (newPointedUser: FriendshipProps) => void,\n    updateFriendList: (friends: FriendshipProps[]) => void,\n    updateMessages: (messages: React.SetStateAction<MessageProps[]>) => void\n}\n\nconst ChatContext = createContext<ChatContextProps>({\n    filter: \"\",\n    pointedUser: null,\n    friends: [],\n    messages: [],\n    changeFilter: () => {},\n    changePointedUser: () => {},\n    updateFriendList: () => {},\n    updateMessages: () => {}\n})\n\n\nconst ChatContextProvider = ({ children }: {children: React.ReactNode}) =>\n{\n  const [filter, setFilter]     =     useState(\"\");\n  const [pointedUser, setPointedUser]     =     useState<FriendshipProps | null>(null);\n  const [friends, setFriends]     =     useState<FriendshipProps[]>([]);\n  const [messages, setMessages] = useState<MessageProps[]>([]);\n\n  const changeFilter = (filter:string) =>\n    {\n        setFilter(filter);\n    }\n  \n    const changePointedUser = (newPointedUser:FriendshipProps) =>\n    {\n        if (newPointedUser !== pointedUser)\n            updateMessages([]);\n        setPointedUser(newPointedUser);\n    }\n    \n    const updateFriendList = (friends: FriendshipProps[]) =>\n    {\n        setFriends(friends);\n    }\n\n    const updateMessages = (messages: React.SetStateAction<MessageProps[]>) =>\n    {\n        setMessages(messages);\n    }\n\n    return (\n        <ChatContext.Provider value={{filter, pointedUser, friends, messages, updateFriendList, changeFilter, changePointedUser, updateMessages}}>\n            {children}\n        </ChatContext.Provider>\n    )\n}\n\nexport default ChatContextProvider;\n\nexport const useChatContext = () =>\n{\n    return (useContext(ChatContext));\n}"],"names":[],"mappings":";;;;;;;AACA;;;AADA;;AAiBA,MAAM,4BAAc,IAAA,yNAAa,EAAmB;IAChD,QAAQ;IACR,aAAa;IACb,SAAS,EAAE;IACX,UAAU,EAAE;IACZ,cAAc,KAAO;IACrB,mBAAmB,KAAO;IAC1B,kBAAkB,KAAO;IACzB,gBAAgB,KAAO;AAC3B;AAGA,MAAM,sBAAsB;QAAC,EAAE,QAAQ,EAA+B;;IAEpE,MAAM,CAAC,QAAQ,UAAU,GAAW,IAAA,oNAAQ,EAAC;IAC7C,MAAM,CAAC,aAAa,eAAe,GAAW,IAAA,oNAAQ,EAAyB;IAC/E,MAAM,CAAC,SAAS,WAAW,GAAW,IAAA,oNAAQ,EAAoB,EAAE;IACpE,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,oNAAQ,EAAiB,EAAE;IAE3D,MAAM,eAAe,CAAC;QAEhB,UAAU;IACd;IAEA,MAAM,oBAAoB,CAAC;QAEvB,IAAI,mBAAmB,aACnB,eAAe,EAAE;QACrB,eAAe;IACnB;IAEA,MAAM,mBAAmB,CAAC;QAEtB,WAAW;IACf;IAEA,MAAM,iBAAiB,CAAC;QAEpB,YAAY;IAChB;IAEA,qBACI,wOAAC,YAAY,QAAQ;QAAC,OAAO;YAAC;YAAQ;YAAa;YAAS;YAAU;YAAkB;YAAc;YAAmB;QAAc;kBAClI;;;;;;AAGb;GAlCM;KAAA;uCAoCS;AAER,MAAM,iBAAiB;;IAE1B,OAAQ,IAAA,sNAAU,EAAC;AACvB;IAHa","debugId":null}},
    {"offset": {"line": 81, "column": 0}, "map": {"version":3,"sources":["file:///home/shamdoun/Desktop/ft_transcendence/frontend/components/features/chat/ChatPreview.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react'\nimport Image from 'next/image'\nimport defaultUser from \"../../../public/defaultUser.svg\"\nimport { useChatContext } from '@/context/ChatContextProvider';\nimport { useAuth } from '@/context/AuthProvider';\nimport { FriendshipProps } from '@/types/common.types';\n\ninterface Props\n{\n    friend: FriendshipProps\n}\n\n\nconst ChatPreview = (data: Props) => {\n    const   chatContext = useChatContext();\n    const   auth = useAuth();\n    const   [latestMessage, setLatestMessage] = useState(\"\");\n    const   [notification, setNotification] = useState(false);\n    const   messageNotification = useRef<WebSocket | null>(null);\n    const   currentPointed = useRef<FriendshipProps>(chatContext.pointedUser);\n\n\n    const getCondition = () => data.friend.username === currentPointed.current?.username;\n\n    useEffect(() =>\n    {\n        currentPointed.current = chatContext.pointedUser;\n    }, [chatContext.pointedUser])\n\n\n    useEffect(() =>\n    {\n        if (!messageNotification.current)\n        {\n            messageNotification.current = new WebSocket(\"ws://localhost:4000/sockets/notifications/chatPreview\");\n            messageNotification.current.onopen = () =>\n            {\n                let value =  {\n                    type: \"registration\",\n                    sender: data.friend.username,\n                    receiver: auth.user?.username\n                }\n                if (messageNotification.current?.readyState === WebSocket.OPEN)\n                    messageNotification.current.send(JSON.stringify(value));\n            }\n            messageNotification.current.onmessage = (msg) =>\n            {\n                const {type, message} = JSON.parse(msg.data.toString());\n                console.log(\"receiving noti\", message);\n                setLatestMessage(message);\n                if (getCondition() === false)\n                    setNotification(true);\n            }\n            messageNotification.current.onerror = (error) => {\n                console.error('WebSocket error:', error);\n            };\n        }\n    },[])\n\n   return (\n    <div onClick={() => {chatContext.changePointedUser(data.friend);\n        setNotification(false);\n    }} className={`h-20 w-full rounded-xl flex px-3 gap-x-5 items-center ${chatContext.pointedUser?.username === data.friend.username && \"bg-[#B0BBCF]\"} ${notification && \"border-2 bg-blue-100 border-white\"}`}>\n        <div className='size-[60] rounded-full bg-gray-200'>\n            <Image className=\"size-fit\" src={defaultUser} alt='search icon'/>\n        </div>\n        <div className='flex flex-col gap-y-0.5'>\n            <h1 className='text-[24px]'>{data.friend.username}</h1>\n            <p className='px-3'>{latestMessage}</p>\n        </div>\n    </div>\n)\n}\n\nexport default ChatPreview\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;;;;;;;;AASA,MAAM,cAAc,CAAC;QAiDsD;;IAhDvE,MAAQ,cAAc,IAAA,+LAAc;IACpC,MAAQ,OAAO,IAAA,iLAAO;IACtB,MAAQ,CAAC,eAAe,iBAAiB,GAAG,IAAA,oNAAQ,EAAC;IACrD,MAAQ,CAAC,cAAc,gBAAgB,GAAG,IAAA,oNAAQ,EAAC;IACnD,MAAQ,sBAAsB,IAAA,kNAAM,EAAmB;IACvD,MAAQ,iBAAiB,IAAA,kNAAM,EAAkB,YAAY,WAAW;IAGxE,MAAM,eAAe;YAA+B;eAAzB,KAAK,MAAM,CAAC,QAAQ,OAAK,0BAAA,eAAe,OAAO,cAAtB,8CAAA,wBAAwB,QAAQ;;IAEpF,IAAA,qNAAS;iCAAC;YAEN,eAAe,OAAO,GAAG,YAAY,WAAW;QACpD;gCAAG;QAAC,YAAY,WAAW;KAAC;IAG5B,IAAA,qNAAS;iCAAC;YAEN,IAAI,CAAC,oBAAoB,OAAO,EAChC;gBACI,oBAAoB,OAAO,GAAG,IAAI,UAAU;gBAC5C,oBAAoB,OAAO,CAAC,MAAM;6CAAG;4BAKnB,YAEV;wBALJ,IAAI,QAAS;4BACT,MAAM;4BACN,QAAQ,KAAK,MAAM,CAAC,QAAQ;4BAC5B,QAAQ,GAAE,aAAA,KAAK,IAAI,cAAT,iCAAA,WAAW,QAAQ;wBACjC;wBACA,IAAI,EAAA,+BAAA,oBAAoB,OAAO,cAA3B,mDAAA,6BAA6B,UAAU,MAAK,UAAU,IAAI,EAC1D,oBAAoB,OAAO,CAAC,IAAI,CAAC,KAAK,SAAS,CAAC;oBACxD;;gBACA,oBAAoB,OAAO,CAAC,SAAS;6CAAG,CAAC;wBAErC,MAAM,EAAC,IAAI,EAAE,OAAO,EAAC,GAAG,KAAK,KAAK,CAAC,IAAI,IAAI,CAAC,QAAQ;wBACpD,QAAQ,GAAG,CAAC,kBAAkB;wBAC9B,iBAAiB;wBACjB,IAAI,mBAAmB,OACnB,gBAAgB;oBACxB;;gBACA,oBAAoB,OAAO,CAAC,OAAO;6CAAG,CAAC;wBACnC,QAAQ,KAAK,CAAC,oBAAoB;oBACtC;;YACJ;QACJ;gCAAE,EAAE;IAEL,qBACC,wOAAC;QAAI,SAAS;YAAO,YAAY,iBAAiB,CAAC,KAAK,MAAM;YAC1D,gBAAgB;QACpB;QAAG,WAAW,AAAC,yDAAwI,OAAhF,EAAA,2BAAA,YAAY,WAAW,cAAvB,+CAAA,yBAAyB,QAAQ,MAAK,KAAK,MAAM,CAAC,QAAQ,IAAI,gBAAe,KAAuD,OAApD,gBAAgB;;0BACnK,wOAAC;gBAAI,WAAU;0BACX,cAAA,wOAAC,sLAAK;oBAAC,WAAU;oBAAW,KAAK,+XAAW;oBAAE,KAAI;;;;;;;;;;;0BAEtD,wOAAC;gBAAI,WAAU;;kCACX,wOAAC;wBAAG,WAAU;kCAAe,KAAK,MAAM,CAAC,QAAQ;;;;;;kCACjD,wOAAC;wBAAE,WAAU;kCAAQ;;;;;;;;;;;;;;;;;;AAIjC;GA3DM;;QACoB,+LAAc;QACrB,iLAAO;;;KAFpB;uCA6DS","debugId":null}},
    {"offset": {"line": 224, "column": 0}, "map": {"version":3,"sources":["file:///home/shamdoun/Desktop/ft_transcendence/frontend/public/search.svg.mjs%20%28structured%20image%20object%20with%20data%20url%29"],"sourcesContent":["import src from \"IMAGE\";\nexport default { src, width: 24, height: 24, blurWidth: 0, blurHeight: 0};\n"],"names":[],"mappings":";;;;AAAA;;uCACe;IAAE,KAAA,+JAAG;IAAE,OAAO;IAAI,QAAQ;IAAI,WAAW;IAAG,YAAY;AAAC","debugId":null}},
    {"offset": {"line": 244, "column": 0}, "map": {"version":3,"sources":["file:///home/shamdoun/Desktop/ft_transcendence/frontend/components/features/chat/SearchBar.tsx"],"sourcesContent":["import React from 'react'\nimport Image from 'next/image'\nimport search from \"../../../public/search.svg\"\nimport { useChatContext } from '@/context/ChatContextProvider';\n\nconst SearchBar = () => {\n  const chatContext = useChatContext();\n  return (\n    <div className='h-10 w-full px-4 bg-[#BEC7DA] rounded-full flex gap-2'>\n    <Image src={search} alt='search icon'/>\n    <input onChange={(event)=>chatContext.changeFilter(event.target.value)} className='outline-none w-full text-[20px]' type='text' placeholder=\"Search\"/>\n</div>\n)\n}\n\nexport default SearchBar\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;;;;;;AAEA,MAAM,YAAY;;IAChB,MAAM,cAAc,IAAA,+LAAc;IAClC,qBACE,wOAAC;QAAI,WAAU;;0BACf,wOAAC,sLAAK;gBAAC,KAAK,qXAAM;gBAAE,KAAI;;;;;;0BACxB,wOAAC;gBAAM,UAAU,CAAC,QAAQ,YAAY,YAAY,CAAC,MAAM,MAAM,CAAC,KAAK;gBAAG,WAAU;gBAAkC,MAAK;gBAAO,aAAY;;;;;;;;;;;;AAGhJ;GARM;;QACgB,+LAAc;;;KAD9B;uCAUS","debugId":null}},
    {"offset": {"line": 304, "column": 0}, "map": {"version":3,"sources":["file:///home/shamdoun/Desktop/ft_transcendence/frontend/components/features/chat/AllChats.tsx"],"sourcesContent":["import React, { useEffect } from 'react'\nimport ChatPreview from './ChatPreview'\nimport SearchBar from './SearchBar';\nimport { useChatContext } from '@/context/ChatContextProvider';\nimport { useAuth } from '@/context/AuthProvider';\nimport { FriendshipProps } from '@/types/common.types';\n\nconst AllChats = () => \n{\n    const chatContext = useChatContext();\n    const auth = useAuth();\n    useEffect(()=>\n        {\n            async function getFriends() {\n                const res = await fetch(`http://localhost:4000/friendships/${auth.user?.id}`);\n                const friends: FriendshipProps[] = await res.json();\n                if (friends.length > 0)\n                {\n                    chatContext.updateFriendList(friends);\n                    if (!chatContext.pointedUser)\n                    {\n                        chatContext.changePointedUser(friends[0]);\n                        console.log(chatContext.pointedUser);\n                    }\n                }\n            }\n            getFriends();\n        }, [chatContext.pointedUser])\n\n    const filteredData:FriendshipProps[] = chatContext.filter.length > 0 ? chatContext.friends.filter((data) => data.username.toLocaleLowerCase().includes(chatContext.filter.toLocaleLowerCase())) : chatContext.friends;\n    return (\n        <div className='flex-1 h-full rounded-t-[30] bg-linear-to-t to-[#93A1BF] from-[#4D658100] padding px-6 py-8 flex flex-col gap-y-5'>\n            <h1 className='text-[24px]'>ALL CHATS FOR</h1>\n            <SearchBar />\n            <div className='flex flex-col gap-y-5 h-full overflow-y-scroll'>\n                {\n                    filteredData.map((v:FriendshipProps) =>\n                        {\n                            return (<ChatPreview key={v.id} friend={v}/>)\n                        }\n                    )\n                }\n            </div>\n        </div>\n    )\n}\n\nexport default AllChats\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;;;;;;;;AAGA,MAAM,WAAW;;IAEb,MAAM,cAAc,IAAA,+LAAc;IAClC,MAAM,OAAO,IAAA,iLAAO;IACpB,IAAA,qNAAS;8BAAC;YAEF,eAAe;oBACkD;gBAA7D,MAAM,MAAM,MAAM,MAAM,AAAC,qCAAkD,QAAd,aAAA,KAAK,IAAI,cAAT,iCAAA,WAAW,EAAE;gBAC1E,MAAM,UAA6B,MAAM,IAAI,IAAI;gBACjD,IAAI,QAAQ,MAAM,GAAG,GACrB;oBACI,YAAY,gBAAgB,CAAC;oBAC7B,IAAI,CAAC,YAAY,WAAW,EAC5B;wBACI,YAAY,iBAAiB,CAAC,OAAO,CAAC,EAAE;wBACxC,QAAQ,GAAG,CAAC,YAAY,WAAW;oBACvC;gBACJ;YACJ;YACA;QACJ;6BAAG;QAAC,YAAY,WAAW;KAAC;IAEhC,MAAM,eAAiC,YAAY,MAAM,CAAC,MAAM,GAAG,IAAI,YAAY,OAAO,CAAC,MAAM,CAAC,CAAC,OAAS,KAAK,QAAQ,CAAC,iBAAiB,GAAG,QAAQ,CAAC,YAAY,MAAM,CAAC,iBAAiB,OAAO,YAAY,OAAO;IACrN,qBACI,wOAAC;QAAI,WAAU;;0BACX,wOAAC;gBAAG,WAAU;0BAAc;;;;;;0BAC5B,wOAAC,qMAAS;;;;;0BACV,wOAAC;gBAAI,WAAU;0BAEP,aAAa,GAAG,CAAC,CAAC;oBAEV,qBAAQ,wOAAC,uMAAW;wBAAY,QAAQ;uBAAd,EAAE,EAAE;;;;;gBAClC;;;;;;;;;;;;AAMxB;GAtCM;;QAEkB,+LAAc;QACrB,iLAAO;;;KAHlB;uCAwCS","debugId":null}},
    {"offset": {"line": 401, "column": 0}, "map": {"version":3,"sources":["file:///home/shamdoun/Desktop/ft_transcendence/frontend/components/features/chat/Message.tsx"],"sourcesContent":["import React from 'react'\n\ninterface Message\n{\n    message: string;\n    type: string;\n}\n\nconst Message = (msg:Message) => {\n  return (\n    <div className={`w-full h-auto flex ${msg.type === \"sent\" && \"flex-row-reverse\"} px-4`}>\n        <div className={`w-[40%] p-3 items-end h-auto ${msg.type === \"sent\" ? \"bg-[#7d8fb8]\" : \"bg-gray-200\"} rounded-md`}>\n            <p>{msg.message}</p>\n        </div>\n    </div>\n)\n}\n\nexport default Message\n"],"names":[],"mappings":";;;;;;AAQA,MAAM,UAAU,CAAC;IACf,qBACE,wOAAC;QAAI,WAAW,AAAC,sBAA+D,OAA1C,IAAI,IAAI,KAAK,UAAU,oBAAmB;kBAC5E,cAAA,wOAAC;YAAI,WAAW,AAAC,gCAAoF,OAArD,IAAI,IAAI,KAAK,SAAS,iBAAiB,eAAc;sBACjG,cAAA,wOAAC;0BAAG,IAAI,OAAO;;;;;;;;;;;;;;;;AAI3B;KARM;uCAUS","debugId":null}},
    {"offset": {"line": 444, "column": 0}, "map": {"version":3,"sources":["file:///home/shamdoun/Desktop/ft_transcendence/frontend/public/sendButton.svg.mjs%20%28structured%20image%20object%20with%20data%20url%29"],"sourcesContent":["import src from \"IMAGE\";\nexport default { src, width: 24, height: 24, blurWidth: 0, blurHeight: 0};\n"],"names":[],"mappings":";;;;AAAA;;uCACe;IAAE,KAAA,mKAAG;IAAE,OAAO;IAAI,QAAQ;IAAI,WAAW;IAAG,YAAY;AAAC","debugId":null}},
    {"offset": {"line": 464, "column": 0}, "map": {"version":3,"sources":["file:///home/shamdoun/Desktop/ft_transcendence/frontend/components/features/chat/MessageForm.tsx"],"sourcesContent":["import React, { use } from 'react'\nimport Image from 'next/image'\nimport SendButton from \"../../../public/sendButton.svg\"\nimport { useAuth } from '@/context/AuthProvider'\nimport { useChatContext } from '@/context/ChatContextProvider'\n\n\ninterface MessageFormProps\n{\n    ref:React.RefObject<WebSocket | null>\n}\n\n\nconst MessageForm = (user: MessageFormProps) => {\n    \n    const chatContext = useChatContext();\n    const auth = useAuth();\n\n    \n    const sendMessage = async (data:FormData) =>\n        {\n            let value = data.get(\"message\");\n            if (!value)\n                return ; \n            try\n            { \n                value = value.toString();\n                let response = await fetch('http://localhost:4000/messages',\n                {\n                    method: \"POST\",\n                    body: JSON.stringify({\n                        friendship_id: chatContext.pointedUser?.id,\n                        receiver: chatContext.pointedUser?.username,\n                        sender: auth.user?.username,\n                        content: value,\n                    }),\n                    headers: {\n                        'Content-type' : 'application/json'\n                    }\n                })\n                response  = await response.json();\n                console.log(\"sending message to\", chatContext.pointedUser);\n                let reply = {type: \"message\", content: response};\n                if (user.ref.current?.readyState === WebSocket.CLOSED)\n                    alert(\"unexpected socket disconnection\")\n                else if (user.ref.current?.readyState === WebSocket.OPEN)\n                    user.ref.current?.send(JSON.stringify(reply));\n            }   \n            catch (err)\n            {\n                alert(err);\n            }\n        }    \n\n  return (\n    <form action={sendMessage} className='flex-1 flex justify-between items-center gap-4 bg-[#92A0BD] px-14'>\n        <div className='flex-8'>\n            <input name='message' type=\"text\" placeholder='Type a message' className='text-[20px] rounded-full w-full h-13 bg-white outline-none px-6'/>\n        </div>\n        <div className='size-13 bg-white rounded-full flex justify-center items-center'>\n            <button type='submit'><Image className='size-8' src={SendButton} alt='send button'/></button>\n        </div>\n    </form>\n)\n}\n\nexport default MessageForm\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AACA;;;;;;;AASA,MAAM,cAAc,CAAC;;IAEjB,MAAM,cAAc,IAAA,+LAAc;IAClC,MAAM,OAAO,IAAA,iLAAO;IAGpB,MAAM,cAAc,OAAO;QAEnB,IAAI,QAAQ,KAAK,GAAG,CAAC;QACrB,IAAI,CAAC,OACD;QACJ,IACA;gBAM2B,0BACL,2BACF,YAUZ,mBAEK,oBACL;YApBJ,QAAQ,MAAM,QAAQ;YACtB,IAAI,WAAW,MAAM,MAAM,kCAC3B;gBACI,QAAQ;gBACR,MAAM,KAAK,SAAS,CAAC;oBACjB,aAAa,GAAE,2BAAA,YAAY,WAAW,cAAvB,+CAAA,yBAAyB,EAAE;oBAC1C,QAAQ,GAAE,4BAAA,YAAY,WAAW,cAAvB,gDAAA,0BAAyB,QAAQ;oBAC3C,MAAM,GAAE,aAAA,KAAK,IAAI,cAAT,iCAAA,WAAW,QAAQ;oBAC3B,SAAS;gBACb;gBACA,SAAS;oBACL,gBAAiB;gBACrB;YACJ;YACA,WAAY,MAAM,SAAS,IAAI;YAC/B,QAAQ,GAAG,CAAC,sBAAsB,YAAY,WAAW;YACzD,IAAI,QAAQ;gBAAC,MAAM;gBAAW,SAAS;YAAQ;YAC/C,IAAI,EAAA,oBAAA,KAAK,GAAG,CAAC,OAAO,cAAhB,wCAAA,kBAAkB,UAAU,MAAK,UAAU,MAAM,EACjD,MAAM;iBACL,IAAI,EAAA,qBAAA,KAAK,GAAG,CAAC,OAAO,cAAhB,yCAAA,mBAAkB,UAAU,MAAK,UAAU,IAAI,GACpD,qBAAA,KAAK,GAAG,CAAC,OAAO,cAAhB,yCAAA,mBAAkB,IAAI,CAAC,KAAK,SAAS,CAAC;QAC9C,EACA,OAAO,KACP;YACI,MAAM;QACV;IACJ;IAEN,qBACE,wOAAC;QAAK,QAAQ;QAAa,WAAU;;0BACjC,wOAAC;gBAAI,WAAU;0BACX,cAAA,wOAAC;oBAAM,MAAK;oBAAU,MAAK;oBAAO,aAAY;oBAAiB,WAAU;;;;;;;;;;;0BAE7E,wOAAC;gBAAI,WAAU;0BACX,cAAA,wOAAC;oBAAO,MAAK;8BAAS,cAAA,wOAAC,sLAAK;wBAAC,WAAU;wBAAS,KAAK,6XAAU;wBAAE,KAAI;;;;;;;;;;;;;;;;;;;;;;AAIjF;GAnDM;;QAEkB,+LAAc;QACrB,iLAAO;;;KAHlB;uCAqDS","debugId":null}},
    {"offset": {"line": 581, "column": 0}, "map": {"version":3,"sources":["file:///home/shamdoun/Desktop/ft_transcendence/frontend/components/features/chat/MainChat.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react'\nimport Image from 'next/image'\nimport defaultUser from \"../../../public/defaultUser.svg\"\nimport Message from './Message'\nimport { MessageProps } from '@/types/common.types'\nimport { useChatContext } from '@/context/ChatContextProvider'\nimport MessageForm from './MessageForm'\nimport { createFilteredCopyOfMessages } from '@/lib/chatLib/chatUtils'\n\ninterface MainChatProps\n{\n    allMessages?: MessageProps[],\n    ref:React.RefObject<WebSocket | null>\n}\n\n\nconst MainChat = (client:MainChatProps) => {\n\n    const   chatContext = useChatContext();\n        \n    useEffect(()=>{\n        async function getMessages()\n        {\n            try\n            {\n                const response = await fetch(`http://localhost:4000/messages/friendship/${chatContext.pointedUser?.id}`, {\n                    method: \"GET\",\n                    headers: {\n                        \"Content-type\": \"application/json\",\n                    },\n                });\n                const data: MessageProps[] = await response.json();\n                chatContext.updateMessages(data.reverse());\n            }\n            catch (err)\n            {\n                console.error(\"failed to fetch messages\")\n            }\n        }\n        let timeout = setTimeout(getMessages, 100);\n        return (() => clearTimeout(timeout));\n    }, [chatContext.pointedUser?.id])\n\n    return (\n    <div className='relative flex-3 flex flex-col h-full rounded-t-[30] bg-[#B0BBCF]'>\n        <div className='flex-1 flex justify-left items-center gap-4 bg-[#92A0BD] rounded-tl-[30] px-14'>\n            <div className='size-11 flex justify-center items-end rounded-full bg-gray-200'>\n                <Image className='fill-current' alt='user' src={defaultUser}/>\n            </div>\n            <h1 className='text-[24px]'>{chatContext.pointedUser?.username}</h1>\n        </div>\n        <div className='flex-15 flex flex-col-reverse py-5 gap-8 wrap-anywhere overflow-scroll'>\n            {                \n                chatContext.messages.map(msg => (\n                    <Message key={msg.id} message={msg.content} type={msg.receiver === chatContext.pointedUser?.username ? \"sent\" : \"received\"} />\n                ))\n            }\n        </div>\n        <MessageForm ref = {client.ref}></MessageForm>\n    </div>\n  )\n}\n\nexport default MainChat\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AAEA;AACA;;;;;;;;;AAUA,MAAM,WAAW,CAAC;QAyBV,0BAQiC;;IA/BrC,MAAQ,cAAc,IAAA,+LAAc;IAEpC,IAAA,qNAAS;8BAAC;YACN,eAAe;gBAEX,IACA;wBAC8E;oBAA1E,MAAM,WAAW,MAAM,MAAM,AAAC,6CAAwE,QAA5B,2BAAA,YAAY,WAAW,cAAvB,+CAAA,yBAAyB,EAAE,GAAI;wBACrG,QAAQ;wBACR,SAAS;4BACL,gBAAgB;wBACpB;oBACJ;oBACA,MAAM,OAAuB,MAAM,SAAS,IAAI;oBAChD,YAAY,cAAc,CAAC,KAAK,OAAO;gBAC3C,EACA,OAAO,KACP;oBACI,QAAQ,KAAK,CAAC;gBAClB;YACJ;YACA,IAAI,UAAU,WAAW,aAAa;YACtC,OAAO;sCAAC,IAAM,aAAa;aAAQ;QACvC;6BAAG;SAAC,2BAAA,YAAY,WAAW,cAAvB,+CAAA,yBAAyB,EAAE;KAAC;IAEhC,qBACA,wOAAC;QAAI,WAAU;;0BACX,wOAAC;gBAAI,WAAU;;kCACX,wOAAC;wBAAI,WAAU;kCACX,cAAA,wOAAC,sLAAK;4BAAC,WAAU;4BAAe,KAAI;4BAAO,KAAK,+XAAW;;;;;;;;;;;kCAE/D,wOAAC;wBAAG,WAAU;mCAAe,4BAAA,YAAY,WAAW,cAAvB,gDAAA,0BAAyB,QAAQ;;;;;;;;;;;;0BAElE,wOAAC;gBAAI,WAAU;0BAEP,YAAY,QAAQ,CAAC,GAAG,CAAC,CAAA;wBAC8C;yCAAnE,wOAAC,mMAAO;wBAAc,SAAS,IAAI,OAAO;wBAAE,MAAM,IAAI,QAAQ,OAAK,2BAAA,YAAY,WAAW,cAAvB,+CAAA,yBAAyB,QAAQ,IAAG,SAAS;uBAAlG,IAAI,EAAE;;;;;;;;;;;0BAIhC,wOAAC,uMAAW;gBAAC,KAAO,OAAO,GAAG;;;;;;;;;;;;AAGtC;GA7CM;;QAEoB,+LAAc;;;KAFlC;uCA+CS","debugId":null}},
    {"offset": {"line": 713, "column": 0}, "map": {"version":3,"sources":["file:///home/shamdoun/Desktop/ft_transcendence/frontend/components/features/chat/ChatsWrapper.tsx"],"sourcesContent":["\"use client\"\nimport React, { useRef, useEffect } from 'react'\nimport AllChats from './AllChats'\nimport MainChat from './MainChat'\nimport { MessageProps } from '@/types/common.types'\nimport { useAuth } from '../../../context/AuthProvider'\nimport { useChatContext } from '@/context/ChatContextProvider'\nimport {FriendshipProps} from \"@/types/common.types\"\n\nconst ChatsWrapper = () => {\n  const auth = useAuth();\n  const chatContext = useChatContext();\n  const socket = useRef<WebSocket | null>(null) ;\n  const currentPointed = useRef<FriendshipProps>(chatContext.pointedUser);\n  \n  useEffect(() =>\n  {\n      currentPointed.current = chatContext.pointedUser;\n  }, [chatContext.pointedUser])\n\n\n\n  useEffect(()=>\n  {\n    if (!socket.current)\n    {\n      socket.current = new WebSocket(\"ws://localhost:4000/sockets/messages\");\n      socket.current.onopen = () =>\n      {\n        let data = {\n          type: \"auth\",\n          content: auth.user?.username \n        }\n        if (socket.current?.readyState === WebSocket.OPEN)\n          socket.current.send(JSON.stringify(data));\n      }\n      socket.current.onmessage = (msg)=>\n      {\n        const {receiver, sender, content, id} = JSON.parse(msg.data);\n        const newMessage: MessageProps = {sender: sender, receiver: receiver, content: content, id: id}\n        console.log(\"adding new message\", newMessage);\n        if (newMessage.receiver === currentPointed.current.username || newMessage.sender === currentPointed.current.username)\n          chatContext.updateMessages((previous) => [newMessage, ...previous]);\n      }\n      socket.current.onerror = (error) => {\n        console.error('WebSocket error:', error);\n      };\n    }\n  },[])\n\n  return (   \n    auth.isLogged && auth.user && <>\n        <div className='h-dvh flex gap-3'>\n          <AllChats />\n          <MainChat ref={socket}/>\n        </div>\n    </>\n  )\n}\n\nexport default ChatsWrapper\n"],"names":[],"mappings":";;;;;AACA;AACA;AACA;AAEA;AACA;;;AANA;;;;;;AASA,MAAM,eAAe;;IACnB,MAAM,OAAO,IAAA,iLAAO;IACpB,MAAM,cAAc,IAAA,+LAAc;IAClC,MAAM,SAAS,IAAA,kNAAM,EAAmB;IACxC,MAAM,iBAAiB,IAAA,kNAAM,EAAkB,YAAY,WAAW;IAEtE,IAAA,qNAAS;kCAAC;YAEN,eAAe,OAAO,GAAG,YAAY,WAAW;QACpD;iCAAG;QAAC,YAAY,WAAW;KAAC;IAI5B,IAAA,qNAAS;kCAAC;YAER,IAAI,CAAC,OAAO,OAAO,EACnB;gBACE,OAAO,OAAO,GAAG,IAAI,UAAU;gBAC/B,OAAO,OAAO,CAAC,MAAM;8CAAG;4BAIX,YAEP;wBAJJ,IAAI,OAAO;4BACT,MAAM;4BACN,OAAO,GAAE,aAAA,KAAK,IAAI,cAAT,iCAAA,WAAW,QAAQ;wBAC9B;wBACA,IAAI,EAAA,kBAAA,OAAO,OAAO,cAAd,sCAAA,gBAAgB,UAAU,MAAK,UAAU,IAAI,EAC/C,OAAO,OAAO,CAAC,IAAI,CAAC,KAAK,SAAS,CAAC;oBACvC;;gBACA,OAAO,OAAO,CAAC,SAAS;8CAAG,CAAC;wBAE1B,MAAM,EAAC,QAAQ,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE,EAAC,GAAG,KAAK,KAAK,CAAC,IAAI,IAAI;wBAC3D,MAAM,aAA2B;4BAAC,QAAQ;4BAAQ,UAAU;4BAAU,SAAS;4BAAS,IAAI;wBAAE;wBAC9F,QAAQ,GAAG,CAAC,sBAAsB;wBAClC,IAAI,WAAW,QAAQ,KAAK,eAAe,OAAO,CAAC,QAAQ,IAAI,WAAW,MAAM,KAAK,eAAe,OAAO,CAAC,QAAQ,EAClH,YAAY,cAAc;sDAAC,CAAC,WAAa;oCAAC;uCAAe;iCAAS;;oBACtE;;gBACA,OAAO,OAAO,CAAC,OAAO;8CAAG,CAAC;wBACxB,QAAQ,KAAK,CAAC,oBAAoB;oBACpC;;YACF;QACF;iCAAE,EAAE;IAEJ,OACE,KAAK,QAAQ,IAAI,KAAK,IAAI,kBAAI;kBAC1B,cAAA,wOAAC;YAAI,WAAU;;8BACb,wOAAC,oMAAQ;;;;;8BACT,wOAAC,oMAAQ;oBAAC,KAAK;;;;;;;;;;;;;AAIzB;GAjDM;;QACS,iLAAO;QACA,+LAAc;;;KAF9B;uCAmDS","debugId":null}}]
}